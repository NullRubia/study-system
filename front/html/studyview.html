<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ìŠ¤í„°ë”” ìƒì„¸</title>
  </head>
  <body>
    <h2>ğŸ“„ ìŠ¤í„°ë”” ìƒì„¸</h2>
    <div id="detail"></div>
    <button onclick="applyStudy()">ìŠ¤í„°ë”” ì‹ ì²­</button>
    <button onclick="location.href='studies.html'">ëª©ë¡</button>

    <div id="members">
      <h4>ì°¸ê°€ì ëª©ë¡</h4>
      <ul id="memberList"></ul>
    </div>

    <script>
      const token = localStorage.getItem("token");
      if (!token) location.href = "login.html";

      const params = new URLSearchParams(location.search);
      const id = params.get("id");

      async function loadDetail() {
        const res = await fetch(`http://localhost:8080/studies/${id}`);
        const study = await res.json();

        const div = document.getElementById("detail");
        div.innerHTML = `
        <h3>${study.title}</h3>
        <p>${study.content}</p>
        <p>ëª¨ì§‘ì¸ì›: ${study.maxMember}</p>
        <p>ë§ˆê°ì¼: ${study.deadline}</p>
        <p>ì‘ì„±ì: ${study.writerUserid}</p>
      `;
      }

      async function applyStudy() {
        const res = await fetch(`http://localhost:8080/applications/${id}`, {
          method: "POST",
          headers: { Authorization: "Bearer " + token },
        });

        const result = await res.text();
        if (res.ok) {
          alert(result);
          location.reload();
        } else {
          alert("âŒ " + result);
        }
      }

      async function loadMembers() {
        const res = await fetch(
          `http://localhost:8080/applications/members/${id}`,
          {
            headers: { Authorization: "Bearer " + token },
          }
        );
        const users = await res.json();
        const ul = document.getElementById("memberList");
        ul.innerHTML = "";
        users.forEach((user) => {
          const li = document.createElement("li");
          li.innerText = user.userid; // ë˜ëŠ” user.name ë“±
          ul.appendChild(li);
        });
      }

      loadDetail();
      loadMembers();
    </script>
  </body>
</html>
